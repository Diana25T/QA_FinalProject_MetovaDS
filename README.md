# Дипломный проект: автоматизация smoke-тестирования раздела Meal Plan веб-приложения Tandoor
**Студент:** Диана 
**Курс:** Тестировщик ПО 
**Образовательная платформа:** EdusonAcademy

## Описание проекта

Проект представляет собой фреймворк для автоматизации smoke-тестирования раздела Meal Plan 
веб-приложения Tandoor, которое позволяет управлять рецептами и планировать питание.
Реализовано тестирование через API и пользовательский интерфейс с использованием 
паттерна Page Object Model и их автоматический запуск через GitLab CI.

**Цели проекта:**
- Проверка ключевых пользовательские сценарии
- Обеспечение стабильности работы раздела Meal Plan
- Интеграция тестирования в процесс CI/CD

**Технологии:**
- Python 3.13
- Pytest - фреймворк для тестирования
- Requests - библиотека для HTTP-запросов
- Selenium WebDriver - автоматизация браузера
- Allure - генерация отчетов о тестировании
- GitLab CI/CD - непрерывная интеграция и доставка
- Docker - контейнеризация окружения

## Требования для запуска

**Системные требования:**
- Python 3.11 или выше
- Google Chrome (для UI тестов)
- GitLab
- Docker и Docker Compose (для локального запуска Tandoor)

**Переменные окружения:**
Должны быть установлены следующие переменные:
```
BASE_URL=http://localhost:8080  # URL вашего Tandoor
TANDOOR_TOKEN=your_bearer_token  # API токен
TANDOOR_USERNAME=your_username   # Логин для UI
TANDOOR_PASSWORD=your_password   # Пароль для UI
```

## Инструкции по установке и запуску

### 1. Клонирование репозитория
```bash
git clone <your-repository-url>
cd <project-directory>
```

### 2. Настройка виртуального окружения
```bash
# Создание виртуального окружения
python -m venv venv

# Активация (Windows)
venv\Scripts\activate

# Активация (Linux/Mac)
source venv/bin/activate
```

### 3. Установка зависимостей
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 4. Настройка переменных окружения
Создайте файл `.env` в корневой директории проекта:
```env
BASE_URL=http://localhost:8080
TANDOOR_TOKEN=ваш_токен_из_tandoor
TANDOOR_USERNAME=ваш_логин
TANDOOR_PASSWORD=ваш_пароль
```

### 5. Получение API токена
Существует два способа получения токена:

**Способ 1: Через интерфейс Tandoor**
1. Авторизуйтесь в Tandoor Recipes
2. Перейдите в Settings → API
3. Сгенерируйте новый токен или используйте существующий

**Способ 2: Через API (если известны логин/пароль)**
```python
from api.client import TandoorAPIClient

client = TandoorAPIClient()

token = client.get_tandoor_token(username, password)
print(f"Ваш токен: {token}")
```

### 6. Запуск тестов

**Запуск всех тестов:**
```bash
pytest tests/ -v
```

**Запуск только API тестов:**
```bash
pytest tests/ -m api -v
```

**Запуск только UI тестов:**
```bash
pytest tests/ -m ui -v
```

**Запуск с генерацией Allure отчета:**
```bash
# Запуск тестов с сохранением результатов
pytest tests/ -v --alluredir=allure-results

# Генерация HTML отчета
allure generate allure-results --clean -o allure-report

# Открытие отчета в браузере
allure open allure-report
```

### 7. Локальный запуск Tandoor (опционально)
Для локального тестирования можно использовать Docker:
```bash
docker-compose up -d
```

## Структура проекта

```
project/
├── api/
│   └── client.py               # Клиент для работы с API Tandoor
├── pages/                      # Page Objects для UI тестов
│   ├── __init__.py
│   ├── base_page.py           # Базовый класс страницы
│   ├── login_page.py          # Страница авторизации
│   ├── meal_plan_page.py      # Страница планов питания
│   ├── shopping_list_page.py  # Страница списка покупок
│   └── components/
│       └── header.py          # Компонент шапки
├── tests/                      # Тесты
│   ├── conftest.py            # Конфигурация и фикстуры Pytest
│   ├── test_api.py            # API тесты
│   ├── test_ui.py             # UI тесты
│   └── test_login.py          # Тесты авторизации
├── test_data/                  # Тестовые данные
│   ├── recipe_links.json      # Ссылки для импорта рецептов
│   └── imported_recipes.json  # Кеш импортированных рецептов
├── .env.example               # Пример файла с переменными окружения
├── .gitlab-ci.yml             # Конфигурация CI/CD
├── requirements.txt           # Зависимости Python
├── README.md                  # Эта документация
└── pytest.ini                # Конфигурация Pytest
```

**Назначение ключевых папок:**
- `api/` - содержит API клиент для взаимодействия с Tandoor
- `pages/` - реализация паттерна Page Object Model
- `tests/` - тестовые сценарии
- `test_data/` - данные для тестирования и кеширование

## Реализованные сценарии тестирования

### API тесты:
1. **Аутентификация** - проверка Bearer Token авторизации
2. **Рецепты** - создание, получение, импорт и удаление рецептов
3. **Планы питания** - полный цикл CRUD операций
4. **Списки покупок** - добавление и удаление позиций
5. **Поиск дубликатов** - автоматическое обнаружение и удаление дублей

### UI тесты:
1. **Авторизация** - проверка успешного входа в систему
2. **Создание планов питания** - через пользовательский интерфейс
3. **Удаление планов** - с подтверждением через API
4. **Интеграция с корзиной** - автоматическое добавление продуктов при создании планов
5. **Навигация** - проверка работы основных элементов интерфейса

## Список используемых библиотек

**Основные зависимости:**
```txt
pytest==7.4.3           # Фреймворк для тестирования
requests==2.31.0        # HTTP-запросы к API
selenium==4.15.2        # Автоматизация браузера
allure-pytest==2.13.2   # Интеграция с Allure
python-dotenv==1.0.0    # Работа с переменными окружения
```

**Вспомогательные библиотеки:**
```txt
webdriver-manager==4.0.1  # Автоматическое управление драйверами
pytest-html==4.1.1        # HTML отчеты Pytest
pytest-xdist==3.5.0       # Параллельный запуск тестов
```

**Для CI/CD:**
```txt
docker==6.1.3            # Работа с Docker (опционально)
```

## Пример файла с переменными окружения

Создайте файл `.env` в корне проекта:

```env
# Обязательные переменные
BASE_URL=https://app.tandoor.dev
TANDOOR_TOKEN=YourToken

# Для UI тестов
TANDOOR_USERNAME=testuser
TANDOOR_PASSWORD=YourPassword


```

## Инструкции по CI/CD

Проект настроен для работы с GitLab CI/CD. Основные этапы пайплайна:

1. **Prepare** - установка зависимостей и настройка окружения
2. **Test API** - запуск API тестов
3. **Test UI** - запуск UI тестов с использованием Selenium
4. **Report** - генерация Allure отчета
5. **Deploy** - публикация отчета на GitLab Pages

**Для запуска в GitLab CI/CD:**
1. Установите переменные окружения в GitLab: `BASE_URL`, `TANDOOR_TOKEN`, `TANDOOR_USERNAME`, `TANDOOR_PASSWORD`
2. При push в ветку main или создании merge request запустится пайплайн
3. После успешного выполнения Allure отчет будет доступен по адресу: `https://<username>.gitlab.io/<project-name>/`

## Особенности проекта

1. **Кеширование импортированных рецептов** - чтобы избежать повторного импорта
2. **Автоматическая очистка тестовых данных** - через фикстуры Pytest
3. **Обработка ошибок** - при недоступности сервисов
4. **Подробные Allure отчеты** - с шагами и скриншотами при падении
5. **Поддержка headless режима** - для запуска в CI/CD окружении

## Устранение неполадок

### Общие проблемы:

**Проблема:** API возвращает 401 ошибку
**Решение:** Проверьте правильность токена в переменной `TANDOOR_TOKEN`

**Проблема:** UI тесты падают с ошибками таймаута
**Решение:** Увеличьте время ожидания в `conftest.py` или проверьте доступность Tandoor

**Проблема:** Allure отчет не генерируется
**Решение:** Убедитесь, что установлена Java и Allure командной строки

### Для разработчиков:

При добавлении новых тестов:
1. Используйте существующие фикстуры для создания тестовых данных
2. Следуйте паттерну Page Object Model для UI тестов
3. Добавляйте маркировки `@pytest.mark.api` или `@pytest.mark.ui`
4. Обновляйте документацию при изменении API

## Контакты и поддержка

Проект разработан для автоматизации тестирования Tandoor Recipes. Для вопросов и предложений обратитесь к автору проекта или создайте issue в репозитории.